---
// DmsConverter.astro
import CalcCard from "../CalcCard.astro";
import CalcInput from "../CalcInput.astro";
---

<CalcCard title="DMS Converter" badge="Angle.v1">
  <div class="space-y-6">
    <!-- Input Section -->
    <div class="grid grid-cols-1 gap-4">
      <CalcInput
        id="decimal-input"
        label="Decimal Degrees"
        type="number"
        value="10"
        step="any"
        max="360"
        min="0"
      />
    </div>

    <!-- Divider with Icon (Standardized) -->
    <div class="flex items-center justify-center py-2">
      <div class="h-px grow bg-zinc-800/50"></div>
      <div class="px-3">
        <svg
          class="w-4 h-4 text-zinc-500"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
        </svg>
      </div>
      <div class="h-px grow bg-zinc-800/50"></div>
    </div>

    <!-- Output Section (Standardized with BarWeight Pattern) -->
    <div class="pt-4 border-t border-zinc-800/30">
      <div class="text-sm text-slate-400 font-medium mb-3">
        DMS Components (Degrees, Minutes, Seconds)
      </div>
      <div class="grid grid-cols-3 gap-3">
        <CalcInput id="dms-deg" label="Degrees" value="10" max="360" min="0" />
        <CalcInput id="dms-min" label="Minutes" value="0" max="60" min="0" />
        <CalcInput
          id="dms-sec"
          label="Seconds"
          value="0"
          max="60"
          min="0"
          step="any"
        />
      </div>
    </div>
  </div>
</CalcCard>

<script>
  const decimalInput = document.getElementById(
    "decimal-input",
  ) as HTMLInputElement;
  const dmsDeg = document.getElementById("dms-deg") as HTMLInputElement;
  const dmsMin = document.getElementById("dms-min") as HTMLInputElement;
  const dmsSec = document.getElementById("dms-sec") as HTMLInputElement;

  function toDMS() {
    const dec = parseFloat(decimalInput.value) || 0;
    const absDec = Math.abs(dec);
    const d = Math.floor(absDec);
    const m = Math.floor((absDec - d) * 60);
    const s = ((absDec - d) * 60 - m) * 60;

    dmsDeg.value = d.toString();
    dmsMin.value = m.toString();
    dmsSec.value = s.toFixed(2);
  }

  function toDecimal() {
    const d = parseFloat(dmsDeg.value) || 0;
    const m = parseFloat(dmsMin.value) || 0;
    const s = parseFloat(dmsSec.value) || 0;
    const dec = d + m / 60 + s / 3600;

    decimalInput.value = dec.toFixed(6);
  }

  decimalInput?.addEventListener("input", toDMS);
  [dmsDeg, dmsMin, dmsSec].forEach((el) =>
    el?.addEventListener("input", toDecimal),
  );
</script>
