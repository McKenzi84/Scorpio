---
// DMS Converter - Pure Astro with vanilla JavaScript
---

<div
  class="glass p-8 rounded-2xl w-full max-w-md mx-auto shadow-2xl"
  aria-labelledby="dms-title"
  style="background: #323b53;"
>
  <div class="flex justify-between items-center mb-6">
    <h2 id="dms-title" class="text-xl font-bold text-white tracking-tight">
      DMS Converter
    </h2>
    <div
      class="text-[10px] font-mono text-blue-500 uppercase tracking-widest bg-blue-500/10 px-2 py-1 rounded"
    >
      Angle.v1
    </div>
  </div>

  <div class="space-y-6">
    {/* Decimal Input */}
    <fieldset class="space-y-2">
      <legend class="text-xs font-mono text-slate-400 uppercase font-semibold"
        >Decimal Degrees</legend
      >
      <input
        id="decimal-input"
        type="number"
        step="any"
        aria-describedby="decimal-desc"
        class="w-full px-3 py-2 rounded-lg bg-zinc-900 border border-zinc-800 focus:border-blue-500 focus:outline-none transition-all duration-200 text-slate-100 text-xl font-semibold"
        value="10"
        max="360"
        min="0"
      />
      <small id="decimal-desc" class="text-xs text-slate-400"
        >Enter decimal degrees (e.g., 45.5)</small
      >
    </fieldset>

    <div class="flex items-center justify-center">
      <div class="h-1px grow bg-zinc-800"></div>
      <div class="px-3 text-zinc-700">
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
        </svg>
      </div>
      <div class="h-1px grow bg-zinc-800"></div>
    </div>

    {/* DMS Inputs */}
    <fieldset class="space-y-2">
      <!-- <legend class="text-xs font-mono text-slate-400 uppercase font-semibold"
        >Degrees / Minutes / Seconds</legend
      > -->
      <div class="grid grid-cols-3 gap-3">
        <div class="space-y-2">
          <label
            for="dms-deg"
            class="text-xs font-mono text-slate-400 uppercase font-semibold"
            >Degrees</label
          >
          <input
            id="dms-deg"
            type="number"
            class="w-full px-3 py-2 rounded-lg bg-zinc-900 border border-zinc-800 focus:border-blue-500 focus:outline-none transition-all duration-200 text-slate-100 text-center font-bold"
            value="10"
            min="0"
            max="360"
          />
        </div>
        <div class="space-y-2">
          <label
            for="dms-min"
            class="text-xs font-mono text-slate-400 uppercase font-semibold"
            >Minutes</label
          >
          <input
            id="dms-min"
            type="number"
            class="w-full px-3 py-2 rounded-lg bg-zinc-900 border border-zinc-800 focus:border-blue-500 focus:outline-none transition-all duration-200 text-slate-100 text-center font-bold"
            value="0"
            max="60"
            min="0"
          />
        </div>
        <div class="space-y-2">
          <label
            for="dms-sec"
            class="text-xs font-mono text-slate-400 uppercase font-semibold"
            >Seconds</label
          >
          <input
            id="dms-sec"
            type="number"
            step="any"
            class="w-full px-3 py-2 rounded-lg bg-zinc-900 border border-zinc-800 focus:border-blue-500 focus:outline-none transition-all duration-200 text-slate-100 text-center font-bold"
            value="0"
            max="60"
            min="0"
          />
        </div>
      </div>
    </fieldset>
  </div>
</div>

<script>
  const decimalInput = document.getElementById(
    "decimal-input",
  ) as HTMLInputElement;
  const degInput = document.getElementById("dms-deg") as HTMLInputElement;
  const minInput = document.getElementById("dms-min") as HTMLInputElement;
  const secInput = document.getElementById("dms-sec") as HTMLInputElement;

  let mode = "decToDms";

  function convertDecToDms(val: number) {
    const absDec = Math.abs(val);
    const d = Math.floor(absDec);
    const m = Math.floor((absDec - d) * 60);
    const s = ((absDec - d - m / 60) * 3600).toFixed(0);
    return {
      d: (val < 0 ? -d : d).toString(),
      m: m.toString(),
      s: s,
    };
  }

  function convertDmsToDec(d: number, m: number, s: number) {
    const sign = d < 0 ? -1 : 1;
    const res = (Math.abs(d) + m / 60 + s / 3600) * sign;
    return res.toFixed(6);
  }

  decimalInput.addEventListener("input", (e) => {
    mode = "decToDms";
    const val = parseFloat(decimalInput.value) || 0;
    const dms = convertDecToDms(val);
    degInput.value = dms.d;
    minInput.value = dms.m;
    secInput.value = dms.s;
  });

  [degInput, minInput, secInput].forEach((input) => {
    input.addEventListener("input", () => {
      mode = "dmsToDec";
      const d = parseFloat(degInput.value) || 0;
      const m = parseFloat(minInput.value) || 0;
      const s = parseFloat(secInput.value) || 0;
      const dec = convertDmsToDec(d, m, s);
      decimalInput.value = dec;
    });
  });
</script>
